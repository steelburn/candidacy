//==============================================================================
// NOTIFICATION SERVICE DATABASE (candidacy_notification)
//==============================================================================

// Notification Service handles:
// - Email notifications
// - SMS notifications (future)
// - Push notifications (future)
// - Notification templates
// - Delivery tracking

Table notification_templates {
  id bigint [pk, increment]
  tenant_id bigint [null, note: 'Logical FK to tenants table. NULL for system templates']
  name varchar(100) [not null, note: 'Unique template identifier']
  subject varchar(255) [not null, note: 'Email subject with variable placeholders']
  body text [not null, note: 'Email body content with variable placeholders']
  type varchar(50) [not null, note: 'interview_scheduled, offer_sent, reminder, etc.']
  variables json [note: 'List of available variables and their descriptions']
  is_active boolean [default: true]
  created_at timestamp
  updated_at timestamp

  indexes {
    tenant_id [name: 'idx_notification_templates_tenant_id']
    type
    is_active
    (tenant_id, name) [unique, name: 'notification_templates_tenant_name_unique']
  }
}

Table notification_logs {
  id bigint [pk, increment]
  tenant_id bigint [not null, note: 'Logical FK to tenants table']
  template_id bigint [note: 'Reference to template used, null if direct content']
  recipient_email varchar(255) [not null]
  recipient_name varchar(255)
  subject varchar(255) [not null]
  body text [note: 'Rendered email body']
  type varchar(50) [not null, note: 'Notification type']
  channel varchar(20) [default: 'email', note: 'email, sms, push']
  status varchar(20) [default: 'pending', note: 'pending, sent, failed']
  metadata json [note: 'Additional context: candidate_id, vacancy_id, etc.']
  sent_at timestamp
  failed_at timestamp
  error_message text
  retry_count int [default: 0]
  created_at timestamp
  updated_at timestamp

  indexes {
    tenant_id [name: 'idx_notification_logs_tenant_id']
    recipient_email
    type
    status
    created_at
    (tenant_id, status) [name: 'idx_notification_logs_tenant_status']
  }
}

Ref: notification_logs.template_id > notification_templates.id
